<!doctype html>
<html>
   <head>
      <meta charset="utf-8">
      <style>
         #lista{
            color: red;
         }
         
         #lista .tags{
            color: blue;
         }
         
         #lista.ocultar_tags .tags {         
            display: none;
         }
      </style>
      <script src="ajax.js"></script>
   </head>
   <body>
      <input type="checkbox" id="cb">Mostrar tags</input>
      <ul id ="lista"></ul>
      <script>
         window.onload = async function( ) {
            let etiquetas = await ajax_post("tags.php", { }, 1000000);
            if (etiquetas instanceof Error) {
               window.alert("Error al recibir respuesta del servidor (TAGS).");
            } else {
               let problem = await ajax_post("problemas.php", { }, 1000000);
               if (problem instanceof Error) {
                  window.alert("Error al recibir respuesta del servidor (Problemas).");
               } else {
                  let ul = document.getElementById("lista");
                  
                  function reorganiza(arreglo, campo) {
                        let res = { };
                        for (let actual of arreglo) {
                           res[actual[campo]] = actual;
                        }
                        return res;
                  }
                  
                  let tags_por_id = reorganiza(etiquetas, "id"); 
                  for (let i = 0; i < problem.length; ++i) {
                     let li1 = document.createElement("li");
                     li1.textContent = `${problem[i].nombre} `;
                     ul.appendChild(li1); 
                     
                     let etiqueta = " ";
                     for (let y = 0; y < problem[i].tags.length; ++y) {
                        let tags_id = problem[i].tags[y];
                        etiqueta += `${tags_por_id[tags_id]["traduccion"]} `;
                     }
                     
                     let nuevo = document.createElement("div")
                     nuevo.setAttribute("class", "tags")
                     nuevo.textContent = etiqueta;
                     li1.appendChild(nuevo);
                  }
               }
            }
         }
  
         document.getElementById('cb').onchange = function( ) {
            document.getElementById("lista").classList.toggle("ocultar_tags");         // .classList.toggle agrega o quita una clase (como si fuera un interruptor: la quita si estaba, la pone si no estaba)
         }
      </script>     
   </body>
</html>
