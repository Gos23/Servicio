<!doctype html>
<html>
   <head>
      <meta charset="utf-8">
      <style>
         #lista{
            color: red;
         }
         
         #lista .tags{
            color: blue;
         }
         
         #lista.ocultar_tags .tags {         
            display: none;
         }
      </style>
      <script src="base/ajax.js"></script>
      <script src="base/drop.js"></script>
      <script src="base/map.js"></script>
   </head>
   <body>
      <input type="checkbox" id="cb" checked>Mostrar tags<br><br>
      <select id="select"></select>
      <script>
         document.getElementById('cb').onchange = function( ) {
            document.getElementById("lista").classList.toggle("ocultar_tags");
         }
         
         window.onload = async function( ) {
            let ueas = await ajax_post("ueas.php", { }, 1000), temas = await ajax_post("temas.php", { }, 1000), tags = await ajax_post("tags.php", { }, 1000), problemas = await ajax_post("problemas.php", { }, 1000);
            if (ueas instanceof Error || temas instanceof Error || tags instanceof Error || problemas instanceof Error) {
               return window.alert("Error al recibir respuesta del servidor.");
            }
            
            let ueas_por_id = reorganiza(ueas, "id", true), tags_por_id = reorganiza(tags, "id", true);
            let temas_por_uea = reorganiza(temas, "uea", false), problemas_por_tema = reorganiza(problemas, "tema", false);
            let actualiza_lista = function(uea_id) {
               console.clear( );
               console.log("(UEA) ", ueas_por_id[uea_id].nombre);
               for (let tema of temas_por_uea[uea_id]) {
                  console.log("   (TEMA) ", tema.nombre);
                  for (let problema of (problemas_por_tema[tema.id] ?? [ ])) {
                     console.log("      (PROBLEMA) ", problema.nombre);
                     for (let tag_id of problema.tags) {
                        console.log("         (TAG) ", tags_por_id[tag_id].traduccion);
                     }
                  }
               }
            };
            
            let select = document.getElementById("select");
            for (let uea of ueas) {
               select.options.add(new Option(uea.nombre, uea.id));         // el texto es el nombre de la uea, el valor es su id
            }
            select.onchange = function( ) {
               actualiza_lista(this.value);
            }
            select.onchange( );
         }
      </script>     
   </body>
</html>
